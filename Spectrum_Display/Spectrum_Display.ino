 /*
 Name:		Spectrum_Display.ino
 Created:	5/25/2017 7:30:13 PM
 Author:	Piotr
*/

#define SW1 12
#define SW2 11

int del = 1000;
int buff3[] = { 0x1,0x24,0x42,0x81,0x81,0x42,0x24,0x18,0x00,0x00,0x18,0x66,0x42,0x81,0x81,0x42,0x66,0x18 };
int buff2[] = { 0x18,0x3c,0x7e,0xff,0xff,0x7e,0x3c,0x18,0x00,0x00,0x00,0x00,0x83,0xc6,0x6c,0x38,0x38,0x6c,0xc6,0x83,0x00,0x00,0x00,0x00,0x00,0x18,0x3c,0x7e,0xff,0xff,0x7e,0x3c,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00 };
int buff[] = { 0x00,0x00,0x3c,0x66,0x43,0xd1,0xc5,0x85,0x91,0x81,0xc3,0x66,0x3c,0x00,0x00,0x00,0x00,0x00,0x3e,0x62,0x42,0x46,0x3c,0x00,0x00,0x3c,0x78,0x38,0x2c,0x66,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 };
int buff4[] = { 0x00,0x00,0x01,0x03,0x07,0x0f,0x1f,0x3f,0x7f,0xff,0x7f,0x3f,0x1f,0x0f,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x38,0x7c,0x7e,0x7e,0x3f,0x3f,0x7e,0x7e,0x7c,0x38,0x00,0x00,0x00,0x00,0x00,0x3c,0x42,0x81,0x99,0x99,0x81,0x42,0x3c,0x00,0x00,0x00 };
int buff5[] = { 0x00,0x00,0x01,0x03,0x07,0x0f,0x1f,0x3f,0x7f,0xff,0x7f,0x3f,0x1f,0x0f,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x38,0x7c,0x7e,0x7e,0x3f,0x3f,0x7e,0x7e,0x7c,0x38,0x00,0x00,0x00,0x00,0x00,0x3c,0x7e,0xff,0xff,0xff,0xff,0x7e,0x3c,0x00,0x00,0x00 };
int* buffers[] = { buff5, buff4, buff3 };
int* bufferPointer = buffers[0];
int selectedBuffer = 0;
void pciSetup(byte pin)
{
	*digitalPinToPCMSK(pin) |= bit(digitalPinToPCMSKbit(pin));  // enable pin
	PCIFR |= bit(digitalPinToPCICRbit(pin)); // clear any outstanding interrupt
	PCICR |= bit(digitalPinToPCICRbit(pin)); // enable interrupt for the group
}

int i = 0;
ISR(PCINT0_vect) // handle pin change interrupt for D8 to D13 here
{
	//if (!digitalRead(SW1) && !digitalRead(SW2))
	//{
		selectedBuffer++;
		if (selectedBuffer > sizeof(buffers)) selectedBuffer = 0;
		
		bufferPointer = buffers[selectedBuffer];

		digitalWrite(13, !digitalRead(13));
		delay(300);
	//}
}

void setup() 
{
	digitalWrite(13, LOW);
	pinMode(SW1, INPUT_PULLUP);
	pinMode(SW2, INPUT_PULLUP);
	DDRD = B11111111;
	pciSetup(SW1);
	pciSetup(SW2);
}

void loop() 
{
	
	for (size_t i = 0; i < 18; i++)
	{
		PORTD = bufferPointer[i];
		delayMicroseconds(del);
	}

  
}
